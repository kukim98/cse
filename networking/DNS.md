# DNS (Domain Name Server)
## Introduction
DNS is used to return the IP address of the destination machine given the URL address. To ensure that the DNS can server billions of requests, there are multiple DNS servers all around the world. Web URLs are composed of a **top-level domain**, **host name**, and **subdomains**.  The top-level domains are like *.com*, *.edu*, and *.gov*.  Host names are the ones that come right before the top-level domain such as *google*, *osu*, and *state*. Subdomains are the ones that come before the host name; this can be *mail*, *docs*, and etc.

## Flow
When the client wants to get the IP address of a URL (**canonical name**), it performs a **NS lookup** which is handled by the **resolver** at port 53. The resolver contacts one of the root servers with the URL. The **root server** returns a list of IP addresses that the resolver can contact based on the URL's top-level domain. For instance, with `google.com`, the root server will return the IP address of a **top-level domain server** that may know the IP address. The resolver will then contact the top-level domain server, and it will respond back with the **authoritative name server** that may know the IP address; these may be hosted by the companies themselves or third-party companies like GoDaddy and etc. The resolver will now return a series of IP addresses that are aliases of the canonical name that the client can use to contact the destination machine. DNS queries are **recursive** and **stateless**. The resolver may cache the query results; each result has **TTL (Time To Live)** which tells for how long the results should be cached. Once expired, new queries will be made to update the cache.

## UDP and DNS Poisoning
DNS runs over **UDP**.  To match the appropriate queries to each other, query IDs are attached to DNS queries. This method opens up the possibility of **DNS poisoning**. Hackers send UDP packets with randomly generated query IDs and the fake IP address. If one of the queries successfully match with one of the DNS queries, the client will access the wrong website.

## Availability
Most DNS issues occur due to outages in the authoritative name servers. When these servers are down, clients cannot get the IP address to access the website. 

## Chrome
When clients typed the canonical name of an URL, Chrome sent out DNS queries to get the IP address of whatever the clients have typed. It will first check the local network to see if the typed string matches any of the endpoints registered. Then, it will send a DNS query to the root server to get the IP address. However, this was overloading the root servers since everyone was sending DNS queries. In addition, Chrome wanted to detect any internal rerouting done by the ISPs or the network managers that intercept and capture traffic from mistyped domain names. So for instance, when a user types `marketing` Chrome wanted to know whether to display `Search marketing` or `https://marketing`.  To do so, Chrome will send out random string DNS queries and will see if it resolves to an IP address at the start. If they do, then the IP address is cached and used to display the appropriate user suggestion. This resulted in DNS overloading, and the feature has been removed after 10 years.

## DoH & DoT
With HTTPS, all the content is securely delivered. ISPs and the government cannot see what you are doing, what you are downloading, and so on. However, the ISPs and the government do have a level of surveillance via DNS queries. Because DNS queries are unencrypted UDP datagrams, they will know that clients are attempting to access certain websites. Some countries will use this to prevent users from accessing certain websites. This is done by replying the DNS query with another IP address or do not propagate DNS queries. Using **DoH (DNS over HTTPS) or DoT (DNS over TLS)**, DNS queries are encrypted before being sent out, and this prevents the ISPs from looking into the content. However, ISPs still can see which domains the clients are attempting to access by **SNI (Server Name Indication)** which occurs during the TLS handshake. And because this is not encrypted, the ISPs can take the approriate measures to block requests from being forwarded to the DoH service provider. Without SNI, ISPs cannot look into the URL, but SNIs are in place to increase coverage and the number of servers available. Some SNIs are encrypted, which completely removes their ability to sniff. Although this makes the web more secure, it prevents the ability of the ISPs and the government to deter access to phishing/scam websites. Also, Cloudflare is now the one that knows where the clients are going.
